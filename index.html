<style>

table {
	border-collapse: collapse;
	font: 14px monospace;
}
td:nth-child(1),
td:nth-child(2) {
	width: 20px;
	text-align: right;
	opacity: .4;
}
td {
	padding: 0 1em;
}

.deletion,
.addition { font-weight: bold; }
.deletion { background: rgba( 200, 100, 100, .5 ); }
.addition { background: rgba( 220, 220, 150, .5 ); }

pre:before {
	content: " ";
	opacity: .3;
	margin-right: .5em;
}
.addition pre:before { content: "+"; }
.deletion pre:before { content: "-"; }

</style>

<div id="log"></div>

<script src="diff.js"></script>
<script>

function showDiff( diff ) {
	var
		d,
		i = 0,
		html = '',
		el = document.createElement( "table" ),
		log = document.querySelector( "#log" ),
		classes = [ "deletion", "", "addition" ]
	;
	for ( ; d = diff[ i ]; ++i ) {
		html += '\
			<tr class="'+ classes[ d[ 0 ] + 1 ] +'">\
				<td>'+ (d[ 0 ] < +1 ? d[ 1 ] + 1 : "") +'</td>\
				<td>'+ (d[ 0 ] > -1 ? d[ 2 ] + 1 : "") +'</td>\
				<td><pre>'+ d[ 3 ].replace( /</g, "&lt;" ) +'</pre></td>\
			</tr>\
		';
	}
	el.innerHTML = html;
	log.appendChild( el );
}

function arrayEquals( a, b ) {
	if ( a === b ) {
		return true;
	}
	if ( a.length !== undefined ) {
		for ( var i = a.length - 1; i >= 0; --i ) {
			if ( !arrayEquals( a[ i ], b[ i ] ) ) {
				console.log(a[ i ], b[ i ])
				return false;
			}
		}
		return a.length === b.length;
	}
	return false;
}

showDiff(
	diff(
		[
			"int main( void ) {",
			'	char * w = "World";',
			'	printf("Hello %s!\\n");',
			"	return 0;",
			"}"
		], [
			"#include <stdio.h>",
			"",
			"int main( void ) {",
			'	char * w = "World";',
			'	printf("Hello %s!\\n", w);',
			"	return 0;",
			"}"
		]
	)
);

console.log(
	arrayEquals(
		diff(
			"012 abc 789",
			"012 defgh 789"
		), [
			[  0,  0,  0, "0" ],
			[  0,  1,  1, "1" ],
			[  0,  2,  2, "2" ],
			[  0,  3,  3, " " ],
			[ -1,  4, -1, "a" ],
			[ -1,  5, -1, "b" ],
			[ -1,  6, -1, "c" ],
			[ +1, -1,  4, "d" ],
			[ +1, -1,  5, "e" ],
			[ +1, -1,  6, "f" ],
			[ +1, -1,  7, "g" ],
			[ +1, -1,  8, "h" ],
			[  0,  7,  9, " " ],
			[  0,  8, 10, "7" ],
			[  0,  9, 11, "8" ],
			[  0, 10, 12, "9" ]
		]
	)
);

console.log(
	arrayEquals(
		diff(
			"012 defgh 789",
			"012 abc 789"
		), [
			[  0,  0,  0, "0" ],
			[  0,  1,  1, "1" ],
			[  0,  2,  2, "2" ],
			[  0,  3,  3, " " ],
			[ -1,  4, -1, "d" ],
			[ -1,  5, -1, "e" ],
			[ -1,  6, -1, "f" ],
			[ -1,  7, -1, "g" ],
			[ -1,  8, -1, "h" ],
			[ +1, -1,  4, "a" ],
			[ +1, -1,  5, "b" ],
			[ +1, -1,  6, "c" ],
			[  0,  9,  7, " " ],
			[  0, 10,  8, "7" ],
			[  0, 11,  9, "8" ],
			[  0, 12, 10, "9" ]
		]
	)
);

console.log(
	arrayEquals(
		diff(
			"012",
			"01"
		), [
			[  0, 0,  0, "0" ],
			[  0, 1,  1, "1" ],
			[ -1, 2, -1, "2" ]
		]
	)
);

console.log(
	arrayEquals(
		diff(
			"01",
			"012"
		), [
			[  0,  0, 0, "0" ],
			[  0,  1, 1, "1" ],
			[ +1, -1, 2, "2" ]
		]
	)
);

console.log(
	arrayEquals(
		diff(
			"XMJYAUZ",
			"MAJAWXUA"
		), [
			[ -1,  0, -1, "X" ],
			[  0,  1,  0, "M" ],
			[  1, -1,  1, "A" ],
			[  0,  2,  2, "J" ],
			[ -1,  3, -1, "Y" ],

			[  0,  4,  3, "A" ],
			[  1, -1,  4, "W" ],
			[  1, -1,  5, "X" ],
			[  0,  5,  6, "U" ],
			[ -1,  6, -1, "Z" ],
			[  1, -1,  7, "A" ]
		]
	)
);

console.log(
	arrayEquals(
		diff(
			"thomas",
			"misty thomas"
		), [
			[ +1, -1,  0, "m" ],
			[ +1, -1,  1, "i" ],
			[ +1, -1,  2, "s" ],
			[  0,  0,  3, "t" ],
			[ +1, -1,  4, "y" ],
			[ +1, -1,  5, " " ],
			[ +1, -1,  6, "t" ],
			[  0,  1,  7, "h" ],
			[  0,  2,  8, "o" ],
			[  0,  3,  9, "m" ],
			[  0,  4, 10, "a" ],
			[  0,  5, 11, "s" ]
		]
	)
);

</script>
